# ğŸš€ Sniper.js Workflow Documentation

## Overview
Sniper.js adalah bot penjadwalan untuk melakukan pembelian token secara otomatis pada waktu launch yang telah ditentukan di Doma Launchpad.

## ğŸ“‹ Alur Kerja Utama

### 1. Inisialisasi & Persiapan
```
- Load environment variables dari .env
- Load schedule.json (daftar launch yang akan di-snipe)
- Koneksi ke RPC Doma (https://doma.drpc.org)
- Cek saldo wallet (ETH + USDC)
- Tampilkan informasi wallet dan saldo
```

### 2. Penjadwalan (Scheduling)
```
- Baca setiap launch dari schedule.json
- Hitung waktu delay hingga launch time
- Set timer untuk setiap launch
- Tunggu hingga waktu launch tiba
```

### 3. Pre-Snipe Checks (Pemeriksaan Sebelum Snipe)
```
Status Checks:
- launchStatus() â†’ Pastikan status = 1 (LAUNCHED)
- tradeLocked() â†’ Pastikan trading tidak terkunci
- migrated() â†’ Pastikan belum migrasi
- getAvailableTokensToBuy() â†’ Cek token tersedia

Token Info:
- name() & symbol() â†’ Dapatkan info token
- decimals() â†’ Dapatkan decimal token

Launchpad Stats:
- tokensSold() â†’ Token yang sudah terjual
- quoteRaised() â†’ USDC yang terkumpul
```

### 4. Approval & Persiapan Transaksi
```
USDC Approval:
- Cek allowance USDC ke launchpad
- Jika perlu, approve USDC (maksimal 10M USDC)

Amount Calculation:
- Parse USDC amount dari config
- Hitung minTokenAmount dengan slippage protection
- Hitung gas limit & gas price
```

### 5. Eksekusi Snipe
```
Gas Estimation:
- launchpad.buy.estimateGas() â†’ Estimasi gas

Build Transaction:
- Tentukan nonce (menghindari conflict)
- Set gas limit (dengan multiplier)
- Set max gas price (batas harga gas)
- Set max priority fee (0.1 gwei)

Send Transaction:
- launchpad.buy(quoteAmount, minTokenAmount, options)
```

### 6. Post-Snipe Monitoring
```
Confirmation:
- tx.wait() â†’ Tunggu block terkonfirmasi
- receipt.status â†’ Pastikan sukses (status = 1)

Result Check:
- token.balanceOf() â†’ Cek saldo token baru
- gasUsed & gasPrice â†’ Hitung biaya gas

Logging:
- Log semua detail transaksi
- Tampilkan link explorer
- Hitung profit/loss
```

### 7. Retry Logic (Jika Gagal)
```
Jika transaksi gagal:
- Tunggu retryDelayMs (configurable)
- Ulangi hingga retryAttempts kali
- Jika semua gagal â†’ abort
```

### 8. Success Flow
```
Jika berhasil:
- Cek apakah tokensSold == launchSupply
- Jika iya â†’ launchpad otomatis migrasi
- Logging sukses + sound alert
- Lanjut ke launch berikutnya (jika ada)
```

## ğŸ¯ Key Features

### A. Schedule-Based Timing
```
launchTime: "2024-12-19T10:00:00Z"
â†“
Hitung delay dari sekarang
â†“
Set timer â†’ tunggu tepat waktu launch
```

### B. Slippage Protection
```
usdcAmount = 100 USDC
availableTokens = 1000 token
launchSupply = 10000 token
â†“
totalSupplyRatio = 1000/10000 = 10%
expectedTokens = 100 * 10% = 10 token
slippage = 5% â†’ minTokenAmount = 10 * 95% = 9.5 token
```

### C. Safety Checks
```
Status Check:
- launchStatus == 1? âœ“
- tradeLocked == false? âœ“  
- migrated == false? âœ“
â†“
Lanjut ke eksekusi
```

### D. Error Handling
```
Jika gagal â†’ Cek error type:
- SlippageTooHigh â†’ Saran naikkan slippage
- LaunchNotInProgress â†’ Cek waktu launch
- LaunchpadPaused â†’ Tunggu unlock
- dll...
```

## ğŸ“Š Workflow Diagram

```
[Start] â†’ [Load Schedule] â†’ [Set Timers]
    â†“
[Timer Trigger] â†’ [Pre-Snipe Checks] â†’ [Approval]
    â†“                              â†“
[Calculate Amounts] â† [Status OK?] â† [Safety Checks]
    â†“
[Gas Estimation] â†’ [Build TX] â†’ [Send TX]
    â†“                              â†“
[Wait Confirmation] â† [TX Success?] â† [Retry Logic]
    â†“
[Check Balance] â†’ [Log Results] â†’ [Next Launch]
```

## âš¡ Performance Optimizations

1. **Parallel API Calls**: Gunakan Promise.all() untuk cek status bersamaan
2. **Gas Optimization**: Gunakan gas multiplier & batas gas price
3. **Nonce Management**: Ambil nonce terbaru tiap transaksi
4. **Retry Strategy**: Delay configurable antar retry
5. **Memory Management**: Hapus timer setelah selesai

## ğŸ”§ Configuration (schedule.json)

```json
{
  "enabled": true,
  "domain": "brag.com",
  "tokenAddress": "0xa1000000006E7B861b62233823062DA63c75C408",
  "launchpadAddress": "0x5089863E97196773038f98459262D866f2281f58",
  "launchTime": "2024-12-19T10:00:00Z",
  "usdcAmount": "100",
  "slippage": 5,
  "gasMultiplier": 1.5,
  "maxGasPrice": "200",
  "retryAttempts": 3,
  "retryDelayMs": 1000
}
```

## ğŸš¨ Safety Features

1. **Slippage Protection**: Mencegah sandwich attacks
2. **Trade Lock Check**: Mendeteksi emergency pause
3. **Migration Check**: Mencegah trade pada launchpad yang sudah migrasi
4. **Status Validation**: Memastikan launch dalam keadaan aktif
5. **Error Handling**: Penanganan error spesifik kontrak

## ğŸ“ˆ Workflow Benefits

- **Maksimal Kecepatan**: Eksekusi tepat waktu launch
- **Minimal Kegagalan**: Retry logic & error handling
- **Keamanan**: Slippage protection & safety checks
- **Transparansi**: Logging detail & explorer links
- **Konfigurasi Fleksibel**: Bisa diatur per launch

## ğŸ”„ Bot States

1. **Idle**: Menunggu timer launch
2. **Pre-Snipe**: Melakukan pemeriksaan
3. **Executing**: Mengirim transaksi
4. **Waiting**: Menunggu konfirmasi
5. **Completed**: Selesai sukses/gagal
6. **Next Launch**: Siap untuk launch berikutnya